<?php/** * Created by PhpStorm. * User: user * Date: 03.06.18 * Time: 01:15 */require_once('View.php');class VotesView extends View{    public function fetch()    {    }    public function newAction()    {        if(isset($_POST['votes'])) {            $from = $this->request->post('from');            $from = date("Y-m-d H:i:s", strtotime($from));            $to = $this->request->post('to');            $to = date("Y-m-d H:i:s", strtotime($to));            $topic_id = $this->request->post('id');            $topic_model = $this->communitys->Topic();            $id = $topic_model->update_topic($topic_id, ['start_date'=>$from, 'end_date'=>$to]);            $this->wall->add_wall(['user_id'=>1, 'type_id'=>$id, 'type'=>'votes',                'url'=>'topic/'.$topic_id, 'text'=>'В сообществе голосования',                'name'=>'name community', 'image'=>'files/community/4.png']);            header('Location: '.$this->config->root_url.'/topic/'.$topic_id);        }    }    public function addAction()    {        $id = $this->request->post('topic_id');        $type = $this->request->post('type');        $vote_model = $this->communitys->Vote();       if(empty($this->user->id) || empty($id))            return false;        $vote_model->add_vote(['topic_id'=>$id, 'user_id'=>$this->user->id, 'type'=>$type]);        $topic_model = $this->communitys->Topic();        $topic = $topic_model->getTopic(['id'=>$id]);        $topic->is_vote = true;        $today = date("Y-m-d H:i:s");        $topic->timer =(strtotime($topic->end_date)>strtotime($today));        $vote = new stdClass();        $vote->vote_for = $vote_model->count_vote(['topic_id'=>$id, "type"=>22]);        $vote->vote_hold = $vote_model->count_vote(['topic_id'=>$id, "type"=>1]);        $vote->vote_yes = $vote_model->count_vote(['topic_id'=>$id, "type"=>0]);        $this->design->assign('vote', $vote);        $this->design->assign('topic', $topic);        $this->design->assign('wrapper', 'ajax.tpl');        $result = $this->design->fetch('topic/timer.tpl');        return $this->ajax->result_json($result);    }}