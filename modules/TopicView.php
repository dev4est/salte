<?PHP/** * Simpla CMS * * @copyright 	2011 Denis Pikusov * @link 		http://simplacms.ru * @author 		Denis Pikusov * * Этот класс использует шаблон page.tpl * */require_once('View.php');use Zend\Http\Request;class TopicView extends View{    public function fetch()    {        if(empty($this->user->id))            return false;        $id = $this->request->get('id');        $topic_model = $this->communitys->Topic();        $vote_model = $this->communitys->Vote();        $topic = $topic_model->getTopic(['id'=>$id]);        //votes        $topic->is_vote = $vote_model->is_vote(['topic_id'=>$id, 'user_id'=>$this->user->id]);        $vote = new stdClass();        $vote->vote_for = $vote_model->count_vote(['topic_id'=>$id, "type"=>1]);        $vote->vote_hold = $vote_model->count_vote(['topic_id'=>$id, "type"=>0]);        $vote->vote_yes = $vote_model->count_vote(['topic_id'=>$id, "type"=>2]);        $this->design->assign('vote', $vote);        $this->design->assign('topic', $topic);        $users_topic = $topic_model->get_comments_users(['topic_id'=>$id]);        $this->design->assign('users_topic', $users_topic);        //console_log($users_topic);        $comments = $topic_model->tree_comments(['topic_id'=>$id]);        $this->design->assign('comments', $comments);        // Отображать скрытые страницы только админу        if(empty($topic) || (!$topic && empty($_SESSION['admin'])))            return false;        return $this->design->fetch('topic.tpl');    }    public function add_vote()    {        $filter['topic_id'] = $this->request->get('topic_id');        $filter['user_id'] = $this->user->id;        $vote_model = $this->communitys->Vote();        if(empty($this->user->id) || empty($filter['topic_id']) || empty($vote_model->is_vote($filter)))            return false;        return true;    }}