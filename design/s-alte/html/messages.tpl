{$page_name = 'qwdwqd' scope=parent}<div class="panel panel-flat">    <div class="panel-heading">        <div class="media-left">            {if $subject->image && $subject->community_id>0}        <a href="/community/{$subject->community_id}" >            <img src="files/community/{$subject->image}" class="img-circle img-lg" alt="">        </a>            {else}                <span class="btn bg-teal-400 btn-rounded btn-icon btn-xlg"> <span class="letter-icon">A</span> </span>            {/if}        </div>        <div class="media-body">            <div class="media-heading">                <h4>{$subject->text}</h4>            </div>        </div>        <div class="heading-elements"><a href="#" class="heading-text"><i class="icon-arrow-left22"></i> Назад</a>            <span class="label bg-success heading-text">{$users|count} active</span>            <ul class="icons-list">                <li><a href="#" data-toggle="modal" data-target="#modal_small"><i class="icon-users4"></i></a></li>            </ul>            {include file="messages/user_modal.tpl"}        </div>        <div class="heading-elements">            <ul class="list-inline list-inline-condensed no-margin">                <!--<li><span class="btn bg-teal-400 btn-xs">+26</span></li>-->            </ul>        </div>    </div>    <hr style="margin: 0;">    <div class="panel-body">        <ul class="media-list chat-stacked content-group chat" id="list">            {*<li class="media date-step content-divider text-muted">                <span>New messages</span>            </li>*}            {foreach $messages as $m}                <li class="media">                    <div class="media-left">                        {if $m->image}                            <img src="files/profile/users/{$m->user_id}/{$m->image}" class="img-sm img-circle" alt="">                        {else}                            <img src="design/{$settings->theme|escape}/assets/images/placeholder.jpg"                                 class="img-circle img-md" alt="">                        {/if}                    </div>                    <div class="media-body">                        <div class="media-heading">                            <a href="#" class="text-semibold">{$m->author}</a>                            <span class="media-annotation pull-right">{$m->create_data} <a href="#"><i                                            class="icon-alarm position-right text-muted"></i></a></span>                        </div>                        {$m->text}                    </div>                </li>                {if $files[$m->id]}                    <li class="media">                        <div class="media-left"></div>                        <div class="media-body">                        {foreach $files[$m->id] as $f}                            {include file="messages/item_file.tpl" f=$f}                        {/foreach}                        </div>                    </li>                {/if}            {/foreach}            {* <li class="media">                 <div class="media-left"><img src="design/{$settings->theme|escape}/assets/images/placeholder.jpg" class="img-circle img-md" alt="">                 </div>                 <div class="media-body media-middle">                     <i class="icon-menu"></i>                 </div>             </li>*}        </ul>        <form id="messages_form" method="post">        <textarea name="message" class="form-control content-group" rows="3" cols="1" id="message"                  placeholder="Enter your message..."></textarea>            <div class="row">                <div class="col-xs-6">                    <!--<ul class="icons-list icons-list-extended mt-10">                        <li><a href="#" data-popup="tooltip" title="" data-container="body"                               data-original-title="Send photo"><i class="icon-file-picture"></i></a></li>                        <li><a href="#" data-popup="tooltip" title="" data-container="body"                               data-original-title="Send video"><i class="icon-file-video"></i></a></li>                        <li><a href="#" data-popup="tooltip" title="" data-container="body" data-original-title="Send file"><i                                        class="icon-file-plus"></i></a></li>                    </ul>-->                    <input type="hidden" name="group" value="{$subject->id}" />                </div>                <div class="col-xs-6 text-right">                    <div tabindex="500" class="btn btn-primary btn-file">                        <i class="icon-file-plus"></i>                        <span class="hidden-xs">Файли</span>                        <input name="media[]" type="file" multiple class="file-input" data-show-caption="false" data-show-upload="false" data-browse-class="btn btn-primary btn-xs" data-remove-class="btn btn-default btn-xs" id="my-input">                    </div>                    <button type="submit" class="btn btn-primary btn-labeled-right">Відправити <b><i                                    class="icon-circle-right2"></i></b></button>                </div>        </form>    </div></div></div><script src="/js/autobahn.js"></script>{literal}<!-- Сам код нашего чата -->    <script>        var conn = new ab.Session('ws://0.0.0.0:8080',            function() {                conn.subscribe('{/literal}{$subject->id}{literal}', function(topic, data) {                    $('#list').append(data.title);                    $("#list").scrollTop($("#list").get(0).scrollHeight+20);                    $('#messages_form')[0].reset();                    // This is where you would add the new article to the DOM (beyond the scope of this tutorial)                    console.log('New article published to category "' + topic + '" : ' + data.title);                });            },            function() {                console.warn('WebSocket connection closed');            },            {'skipSubprotocolCheck': true}        );    </script>    <script>        $(document).ready(function () {            $("#list").scrollTop($("#list").get(0).scrollHeight);            $("#messages_form").submit(function(event) {                if($('#message').val() ==='')                    return false;                //stop submit the form, we will post it manually.                event.preventDefault();                // Get form                var form = $('#messages_form')[0];                // Create an FormData object                var data = new FormData(form);                $.ajax({                    type: "POST",                    enctype: 'multipart/form-data',                    url: "messages/send",                    data: data,                    dataType: 'json',                    processData: false,                    contentType: false,                    cache: false,                    timeout: 600000,                    success: function (data) {                        form.reset();                    },                    error: function (e) {                    }                });                return false;            });        });    </script>{/literal}